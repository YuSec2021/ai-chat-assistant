# AIå¯¹è¯åŠ©æ‰‹è®¾è®¡æ–‡æ¡£ï¼ˆv1.2ï¼‰

## 1. é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**ï¼šAIå¯¹è¯åŠ©æ‰‹ï¼ˆAI Chat Assistantï¼‰
**ç”¨é€”**ï¼šä¸€ä¸ªå…¨æ ˆAIå¯¹è¯æ¡†æ¶ï¼Œæä¾›ç±»Gemini/Grokçš„èŠå¤©ä½“éªŒï¼Œæ”¯æŒä¸Šä¸‹æ–‡è®°å¿†ã€Markdownæ¸²æŸ“ã€é™„ä»¶å¤„ç†ï¼Œå¹¶å…·å¤‡å¯æ‰©å±•çš„Agentè·¯ç”±æœºåˆ¶ã€‚æ ¸å¿ƒæ˜¯"æ™ºèƒ½ä¸»ç®¡Agent + å¯æ’æ‹”ä¸“ä¸šAgent"çš„æ¶æ„ï¼Œä¸»Agentè´Ÿè´£æ„å›¾è¯†åˆ«ä¸ä»»åŠ¡åˆ†é…ï¼Œä¸“ä¸šAgentè´Ÿè´£å…·ä½“å‚ç›´ä»»åŠ¡æ‰§è¡Œã€‚

**æ ¸å¿ƒç‰¹æ€§**
- å‰ç«¯ï¼šNext.js 14 ç°ä»£WebèŠå¤©ç•Œé¢ï¼Œæ”¯æŒMarkdownæ¸²æŸ“ã€æ·±è‰²/æµ…è‰²ä¸»é¢˜åˆ‡æ¢ã€æµå¼å“åº”
- åç«¯ï¼šFastAPI å¯¹è¯å†å²ç®¡ç†ã€ä¸Šä¸‹æ–‡è®°å¿†ã€é™„ä»¶ä¸´æ—¶ä¸Šä¼ å¤„ç†ã€æ„å›¾è¯†åˆ«è·¯ç”±
- æ‰©å±•æ€§ï¼šä¸ä¾èµ–LangChain/CrewAIç­‰æ¡†æ¶ï¼Œé€šè¿‡åŸç”ŸLLMå‡½æ•°è°ƒç”¨æˆ–è‡ªå®šä¹‰è·¯ç”±è¡¨å®ç°Agentè°ƒåº¦
- æ•°æ®åº“ï¼šMongoDB çµæ´»å­˜å‚¨å¯¹è¯å†å²

**å˜æ›´è®°å½•ï¼ˆv1.2ï¼‰**
- å®Œæˆå‰ç«¯ Next.js 14 App Router æ¶æ„å®ç°
- å®ç° WebSocket æµå¼èŠå¤©åŠŸèƒ½
- å®Œæˆä¸»é¢˜åˆ‡æ¢ç³»ç»Ÿï¼ˆæ·±è‰²/æµ…è‰²/è‡ªåŠ¨ï¼‰
- å®ç°å¯¹è¯ç®¡ç†ï¼ˆæ–°å»ºã€åˆ é™¤ã€ç¼–è¾‘ã€æœç´¢ï¼‰
- ä¿®å¤å¤šä¸ªå…³é”®bugï¼ˆWebSocketè¿æ¥ã€æ¶ˆæ¯æ¸²æŸ“ã€çŠ¶æ€ç®¡ç†ï¼‰
- è¯†åˆ«å¹¶è®°å½•å¾…ä¼˜åŒ–çš„å®‰å…¨æ€§å’Œæ€§èƒ½é—®é¢˜

## 2. å·²å®ç°åŠŸèƒ½

### 2.1 å‰ç«¯åŠŸèƒ½ âœ…

#### æ ¸å¿ƒå¸ƒå±€
- âœ… å·¦ä¾§ä¾§è¾¹æ ï¼ˆå¯¹è¯å†å²åˆ—è¡¨ï¼‰
  - æ–°å»ºå¯¹è¯æŒ‰é’®
  - æœç´¢åŠŸèƒ½ï¼ˆå®æ—¶è¿‡æ»¤å¯¹è¯ï¼‰
  - å¯¹è¯é¡¹æ“ä½œï¼ˆç¼–è¾‘æ ‡é¢˜ã€åˆ é™¤ï¼‰
  - é«˜äº®å½“å‰å¯¹è¯
- âœ… ä¸»èŠå¤©åŒºåŸŸ
  - æ ‡é¢˜æ æ˜¾ç¤ºå½“å‰å¯¹è¯ä¸»é¢˜
  - ä¸»é¢˜åˆ‡æ¢æŒ‰é’®ï¼ˆæ·±è‰²/æµ…è‰²/è‡ªåŠ¨ï¼‰
  - æ¶ˆæ¯æµå±•ç¤ºï¼ˆæ”¯æŒè‡ªåŠ¨æ»šåŠ¨ï¼‰
  - åº•éƒ¨è¾“å…¥æ¡†ï¼ˆæ”¯æŒEnterå‘é€ã€Shift+Enteræ¢è¡Œï¼‰

#### æ¶ˆæ¯æ¸²æŸ“
- âœ… ç”¨æˆ·æ¶ˆæ¯ï¼šå³å¯¹é½ï¼ŒPrimary èƒŒæ™¯
- âœ… AIæ¶ˆæ¯ï¼šå·¦å¯¹é½ï¼ŒMuted èƒŒæ™¯ï¼Œæ¸å˜å¤´åƒ
- âœ… Markdown å®Œæ•´æ¸²æŸ“
  - ä»£ç å—è¯­æ³•é«˜äº®ï¼ˆhighlight.js + github-dark ä¸»é¢˜ï¼‰
  - GFM æ”¯æŒï¼ˆè¡¨æ ¼ã€åˆ é™¤çº¿ã€ä»»åŠ¡åˆ—è¡¨ï¼‰
  - è‡ªåŠ¨é“¾æ¥å’Œé‚®ç®±è¯†åˆ«
- âœ… æµå¼è¾“å‡ºåŠ¨ç”»ï¼ˆå…‰æ ‡è„‰å†²æ•ˆæœï¼‰
- âœ… é™„ä»¶é¢„è§ˆï¼ˆç¼©ç•¥å›¾ã€æ–‡ä»¶åã€åˆ é™¤æŒ‰é’®ï¼‰

#### ä¸»é¢˜åˆ‡æ¢
- âœ… next-themes é›†æˆ
- âœ… æ·±è‰²/æµ…è‰²/ç³»ç»Ÿè‡ªåŠ¨æ¨¡å¼
- âœ… æŒä¹…åŒ–åˆ° localStorage
- âœ… CSS å˜é‡å®ç°å¹³æ»‘åˆ‡æ¢

#### é™„ä»¶ä¸Šä¼ 
- âœ… æ‹–æ‹½ä¸Šä¼ æ”¯æŒ
- âœ… ç‚¹å‡»é€‰æ‹©æ–‡ä»¶
- âœ… æ–‡ä»¶ç±»å‹éªŒè¯ï¼ˆPDFã€å›¾ç‰‡ï¼‰
- âœ… é™„ä»¶é¢„è§ˆå’Œç§»é™¤
- âœ… å­—ç¬¦è®¡æ•°å™¨

#### äº¤äº’åŠŸèƒ½
- âœ… æ–°å»ºå¯¹è¯
- âœ… åˆ é™¤å¯¹è¯ï¼ˆå¸¦ç¡®è®¤æç¤ºï¼‰
- âœ… ç¼–è¾‘å¯¹è¯æ ‡é¢˜ï¼ˆè¡Œå†…ç¼–è¾‘ï¼‰
- âœ… æœç´¢å¯¹è¯å†å²
- âœ… è¾“å…¥æ¡†è‡ªåŠ¨è°ƒæ•´é«˜åº¦
- âœ… æµå¼å“åº”æ—¶ç¦ç”¨è¾“å…¥

### 2.2 åç«¯åŠŸèƒ½ âœ…

#### å¯¹è¯ç®¡ç†
- âœ… åˆ›å»ºå¯¹è¯ï¼ˆç”Ÿæˆ UUIDï¼‰
- âœ… åˆ—å‡ºå¯¹è¯ï¼ˆæŒ‰æ›´æ–°æ—¶é—´å€’åºï¼‰
- âœ… è·å–å•ä¸ªå¯¹è¯è¯¦æƒ…
- âœ… åˆ é™¤å¯¹è¯
- âœ… æ›´æ–°å¯¹è¯æ ‡é¢˜
- âœ… è·å–å¯¹è¯æ¶ˆæ¯åˆ—è¡¨

#### WebSocket æµå¼èŠå¤©
- âœ… WebSocket è¿æ¥ç®¡ç†
- âœ… å®æ—¶æµå¼å“åº”
- âœ… å¯¹è¯ä¸Šä¸‹æ–‡ä¼ é€’
- âœ… ç”¨æˆ·æ¶ˆæ¯ä¿å­˜
- âœ… AI æ¶ˆæ¯æµå¼ç”Ÿæˆå’Œä¿å­˜
- âœ… é”™è¯¯å¤„ç†å’Œæ–­å¼€é‡è¿

#### LLM é›†æˆ
- âœ… ç»Ÿä¸€ LLM å®¢æˆ·ç«¯ï¼ˆæ”¯æŒ OpenAI/Anthropic/Qwenï¼‰
- âœ… æµå¼å’Œéæµå¼ API
- âœ… Agent ç³»ç»Ÿ
    - SupervisorAgentï¼ˆæ„å›¾è¯†åˆ«å’Œè·¯ç”±ï¼‰
    - FinancialAnalysisAgentï¼ˆé‡‘èåˆ†æï¼‰
    - DocumentAnalysisAgentï¼ˆæ–‡æ¡£åˆ†æï¼‰
- âœ… åŠ¨æ€ Agent æ³¨å†Œæœºåˆ¶

#### é™„ä»¶å¤„ç†
- âœ… æ–‡ä»¶ä¸Šä¼ æ¥å£
- âœ… ä¸´æ—¶æ–‡ä»¶å­˜å‚¨ï¼ˆtemp/ ç›®å½•ï¼‰
- âœ… æ–‡ä»¶ç±»å‹éªŒè¯
- âœ… æ–‡ä»¶å¤§å°é™åˆ¶
- âœ… ä½¿ç”¨åè‡ªåŠ¨æ¸…ç†

#### æ•°æ®åº“
- âœ… MongoDB è¿æ¥ç®¡ç†
- âœ… å¯¹è¯é›†åˆï¼ˆconversationsï¼‰
- âœ… æ¶ˆæ¯å­˜å‚¨ç»“æ„
- âœ… ç´¢å¼•ä¼˜åŒ–

## 3. å·²ä¿®å¤çš„å…³é”® Bug

### Bug ä¿®å¤è®°å½•

#### Bug #1: WebSocket è·¯å¾„é”™è¯¯ 403
**é—®é¢˜**: WebSocket ç«¯ç‚¹è·¯å¾„ä¸åŒ¹é…ï¼ˆå‰ç«¯ `/ws/` vs åç«¯ `/api/chat/ws/`ï¼‰
**ä¿®å¤**: æ›´æ–°å‰ç«¯ WebSocket URL é…ç½®
**æ–‡ä»¶**:
- `frontend/lib/websocket.ts`
- `frontend/.env.local`
- `frontend/.env.example`

#### Bug #2: å¯¹è¯ ID ä¸€è‡´æ€§é—®é¢˜
**é—®é¢˜**: åˆ›å»ºå¯¹è¯å `id` å­—æ®µè¢« `_id` (ObjectId) è¦†ç›–ï¼Œå¯¼è‡´æŸ¥æ‰¾å¤±è´¥
**ä¿®å¤**: ä¿ç•™ UUID ä½œä¸º `id` å­—æ®µï¼Œåˆ é™¤ `_id` å­—æ®µ
**æ–‡ä»¶**: `backend/src/api/conversations.py`

#### Bug #3: WebSocket ç«‹å³æ–­å¼€
**é—®é¢˜**: `useEffect` ä¾èµ–æ•°ç»„åŒ…å« `conversation`ï¼Œæ¯æ¬¡æ¶ˆæ¯æ›´æ–°éƒ½æ–­å¼€è¿æ¥
**ä¿®å¤**: åˆ†ç¦» WebSocket è¿æ¥å’Œå¯¹è¯æ›´æ–°çš„é€»è¾‘
**æ–‡ä»¶**: `frontend/app/chat/[id]/page.tsx`

#### Bug #4: æ¸²æŸ“æœŸé—´ setState é”™è¯¯
**é—®é¢˜**: åœ¨ `setStreamingContent` å›è°ƒä¸­ç›´æ¥è°ƒç”¨ `addMessage`
**ä¿®å¤**: ä½¿ç”¨ `pendingMessageRef` å­˜å‚¨å¾…å¤„ç†æ¶ˆæ¯ï¼Œåœ¨ `useEffect` ä¸­æ·»åŠ 
**æ–‡ä»¶**: `frontend/app/chat/[id]/page.tsx`

#### Bug #5: éæµå¼å“åº”
**é—®é¢˜**: WebSocket ä½¿ç”¨éæµå¼ API é€å­—ç¬¦å‘é€ï¼Œæ•ˆç‡ä½
**ä¿®å¤**: æ”¹ç”¨çœŸæ­£çš„æµå¼ API `get_llm_response_stream`
**æ–‡ä»¶**: `backend/src/api/chat.py`

#### Bug #6: ä¾§è¾¹æ é‡å¤æ¸²æŸ“
**é—®é¢˜**: Layout å’Œ Page éƒ½æ¸²æŸ“ä¾§è¾¹æ ï¼Œå¯¼è‡´é‡å¤
**ä¿®å¤**: åªåœ¨ Layout ä¸­æ¸²æŸ“ä¾§è¾¹æ ï¼ŒPage åªæ¸²æŸ“å†…å®¹
**æ–‡ä»¶**:
- `frontend/app/chat/layout.tsx`
- `frontend/app/chat/[id]/page.tsx`
- `frontend/app/chat/new/page.tsx`

## 4. å¾…ä¼˜åŒ–çš„å®‰å…¨å’Œæ€§èƒ½é—®é¢˜

### 4.1 å…³é”®å®‰å…¨é—®é¢˜ ğŸ”´

#### 1. API å¯†é’¥ç®¡ç†
**é£é™©**: ç”Ÿäº§ API å¯†é’¥å¯èƒ½æš´éœ²åœ¨ç¯å¢ƒå˜é‡ä¸­
**å»ºè®®**:
- ä½¿ç”¨å¯†é’¥ç®¡ç†æœåŠ¡ï¼ˆAWS Secrets Managerã€HashiCorp Vaultï¼‰
- å®ç°å¯†é’¥è½®æ¢æœºåˆ¶
- ä½¿ç”¨ `.env.example` æ¨¡æ¿ï¼Œä¸æäº¤å®é™…å¯†é’¥

#### 2. CORS é…ç½®
**å½“å‰**: `allow_origins=["*"]`
**é£é™©**: å…è®¸ä»»ä½•æºè®¿é—®ï¼ŒCSRF æ”»å‡»
**å»ºè®®**:
```python
allow_origins=[
    "http://localhost:3000",
    "https://yourdomain.com"
]
```

#### 3. WebSocket è®¤è¯ç¼ºå¤±
**é—®é¢˜**: WebSocket è¿æ¥æ— èº«ä»½éªŒè¯
**å»ºè®®**:
- å®ç° JWT token éªŒè¯
- è¿æ¥æ—¶éªŒè¯ token
- å®šæœŸéªŒè¯ä¼šè¯æœ‰æ•ˆæ€§

#### 4. æ–‡ä»¶ä¸Šä¼ å®‰å…¨
**é—®é¢˜**:
- æ–‡ä»¶å®Œå…¨è¯»å…¥å†…å­˜åéªŒè¯å¤§å°
- æ— æ–‡ä»¶åæ¶ˆæ¯’å¤„ç†
- æ— ç—…æ¯’æ‰«æ

**å»ºè®®**:
```python
# 1. å…ˆæ£€æŸ¥å¤§å°
if file.content_length > settings.max_upload_size:
    raise HTTPException(400, "File too large")

# 2. æ¶ˆæ¯’æ–‡ä»¶å
from pathlib import Path
safe_filename = Path(file.filename).name

# 3. éªŒè¯æ–‡ä»¶ç±»å‹
import magic
mime_type = magic.from_buffer(file_header, mime=True)
```

### 4.2 æ€§èƒ½ä¼˜åŒ–é—®é¢˜ ğŸŸ¡

#### 1. ç¼ºå°‘é€Ÿç‡é™åˆ¶
**å½±å“**: API æ»¥ç”¨ã€DoS æ”»å‡»
**å»ºè®®**:
```python
from slowapi import Limiter
limiter = Limiter(key_func=get_remote_address)

@limiter.limit("10/minute")
@router.post("/{conv_id}")
async def send_message(...):
    ...
```

#### 2. æ•°æ®åº“è¿æ¥æ± 
**å»ºè®®**: é…ç½® Motor è¿æ¥æ± å‚æ•°
```python
client = AsyncIOPyMongoClient(
    settings.mongo_url,
    maxPoolSize=50,
    minPoolSize=10,
    maxIdleTimeMS=30000
)
```

#### 3. å‰ç«¯å†…å­˜æ³„æ¼é£é™©
**é—®é¢˜**: WebSocket é‡è¿é€»è¾‘å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼
**å»ºè®®**: å®ç°è¿æ¥è¶…æ—¶å’Œæœ€å¤§é‡è¯•æ¬¡æ•°é™åˆ¶

#### 4. æœªä¼˜åŒ–çš„æ¸²æŸ“
**å»ºè®®**:
- å®ç° React.memo ä¼˜åŒ–ç»„ä»¶
- ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨å¤„ç†å¤§é‡æ¶ˆæ¯
- ä»£ç åˆ†å‰²ï¼ˆReact.lazy + Suspenseï¼‰

### 4.3 ä»£ç è´¨é‡æ”¹è¿› ğŸŸ¢

#### 1. é”™è¯¯å¤„ç†
**å½“å‰**: éƒ¨åˆ†é”™è¯¯ç›´æ¥è¿”å› `str(e)`
**å»ºè®®**:
- å®ç°ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼
- æ·»åŠ å…¨å±€å¼‚å¸¸å¤„ç†å™¨
- é”™è¯¯æ¶ˆæ¯ä¸æš´éœ²å†…éƒ¨å®ç°

#### 2. æ—¥å¿—å®‰å…¨
**é—®é¢˜**: å¯èƒ½è®°å½•æ•æ„Ÿä¿¡æ¯
**å»ºè®®**:
```python
# å®ç°æ—¥å¿—æ¶ˆæ¯’
def sanitize_log(data: dict) -> dict:
    sensitive_keys = ['api_key', 'password', 'token']
    return {k: '***' if k in sensitive_keys else v
            for k, v in data.items()}
```

#### 3. è¾“å…¥éªŒè¯
**å»ºè®®**:
- å‰ç«¯ï¼šéªŒè¯æ¶ˆæ¯é•¿åº¦ã€æ ¼å¼
- åç«¯ï¼šPydantic æ¨¡å‹éªŒè¯
- æ•°æ®åº“ï¼šå‚æ•°åŒ–æŸ¥è¯¢

#### 4. æµ‹è¯•è¦†ç›–
**å½“å‰**: ç¼ºå°‘å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
**å»ºè®®**:
- åç«¯ï¼špytest + pytest-asyncio
- å‰ç«¯ï¼šJest + React Testing Library
- E2Eï¼šPlaywright

## 5. æŠ€æœ¯æ ˆï¼ˆæœ€ç»ˆç‰ˆï¼‰

### å‰ç«¯
```json
{
  "framework": "Next.js 15.1.0",
  "language": "TypeScript",
  "styling": "Tailwind CSS",
  "components": "shadcn/ui",
  "markdown": "react-markdown + remark-gfm + rehype-highlight",
  "state": "Zustand",
  "theme": "next-themes",
  "websocket": "åŸç”Ÿ WebSocket API",
  "utilities": "clsx + tailwind-merge"
}
```

### åç«¯
```python
{
  "framework": "FastAPI",
  "async_runtime": "uvicorn",
  "database": "MongoDB (Motor)",
  "llm": "OpenAI / Anthropic / Qwen",
  "config": "pydantic-settings",
  "logging": "structlog",
  "validation": "Pydantic v2"
}
```

## 6. API æ¥å£æ–‡æ¡£

### REST API

| æ–¹æ³•   | è·¯å¾„                           | åŠŸèƒ½                 | è®¤è¯ |
|--------|--------------------------------|----------------------|------|
| GET    | /api/conversations             | è·å–å¯¹è¯åˆ—è¡¨         | âŒ   |
| POST   | /api/conversations             | åˆ›å»ºæ–°å¯¹è¯           | âŒ   |
| GET    | /api/conversations/{id}        | è·å–å¯¹è¯è¯¦æƒ…         | âŒ   |
| DELETE | /api/conversations/{id}        | åˆ é™¤å¯¹è¯             | âŒ   |
| PATCH  | /api/conversations/{id}        | æ›´æ–°å¯¹è¯æ ‡é¢˜         | âŒ   |
| GET    | /api/conversations/{id}/messages | è·å–å¯¹è¯æ¶ˆæ¯       | âŒ   |
| POST   | /api/chat/{conv_id}           | å‘é€æ¶ˆæ¯ï¼ˆéæµå¼ï¼‰   | âŒ   |
| POST   | /upload                        | ä¸Šä¼ é™„ä»¶             | âŒ   |

### WebSocket

```
URL: ws://localhost:6969/api/chat/ws/{conv_id}

å‘é€æ ¼å¼:
{
  "content": "ç”¨æˆ·æ¶ˆæ¯",
  "attachments": ["file1.pdf", "file2.png"]
}

æ¥æ”¶æ ¼å¼ï¼ˆæµå¼ï¼‰:
{
  "content": "æ–‡æœ¬ç‰‡æ®µ",
  "done": false,
  "metadata": {
    "message_id": "uuid"
  }
}

æ¥æ”¶æ ¼å¼ï¼ˆå®Œæˆï¼‰:
{
  "content": "",
  "done": true,
  "metadata": {
    "message_id": "uuid"
  }
}

æ¥æ”¶æ ¼å¼ï¼ˆé”™è¯¯ï¼‰:
{
  "error": "é”™è¯¯æ¶ˆæ¯"
}
```

## 7. é¡¹ç›®ç»“æ„ï¼ˆå½“å‰å®é™…ï¼‰

```
ai_talking/
â”œâ”€â”€ frontend/                          # Next.js 15 å‰ç«¯
â”‚   â”œâ”€â”€ app/                           # App Router
â”‚   â”‚   â”œâ”€â”€ layout.tsx                 # æ ¹å¸ƒå±€ + ThemeProvider
â”‚   â”‚   â”œâ”€â”€ page.tsx                   # é¦–é¡µï¼ˆé‡å®šå‘åˆ° /chat/newï¼‰
â”‚   â”‚   â”œâ”€â”€ globals.css                # å…¨å±€æ ·å¼ + Tailwind
â”‚   â”‚   â””â”€â”€ chat/                      # èŠå¤©è·¯ç”±ç»„
â”‚   â”‚       â”œâ”€â”€ layout.tsx             # èŠå¤©å¸ƒå±€ï¼ˆä¾§è¾¹æ  + ä¸»åŒºï¼‰
â”‚   â”‚       â”œâ”€â”€ new/page.tsx           # æ–°å»ºå¯¹è¯é¡µ
â”‚   â”‚       â””â”€â”€ [id]/page.tsx          # å¯¹è¯è¯¦æƒ…é¡µ
â”‚   â”œâ”€â”€ components/                    # ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ chat-sidebar.tsx           # ä¾§è¾¹æ 
â”‚   â”‚   â”œâ”€â”€ chat-main.tsx              # ä¸»åŒºåŸŸå®¹å™¨
â”‚   â”‚   â”œâ”€â”€ chat-header.tsx            # æ ‡é¢˜æ 
â”‚   â”‚   â”œâ”€â”€ chat-messages.tsx          # æ¶ˆæ¯åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ chat-message.tsx           # å•æ¡æ¶ˆæ¯
â”‚   â”‚   â”œâ”€â”€ chat-input.tsx             # è¾“å…¥æ¡†
â”‚   â”‚   â”œâ”€â”€ welcome-screen.tsx         # æ¬¢è¿é¡µ
â”‚   â”‚   â”œâ”€â”€ theme-provider.tsx         # ä¸»é¢˜æä¾›è€…
â”‚   â”‚   â””â”€â”€ ui/
â”‚   â”‚       â””â”€â”€ button.tsx             # Button ç»„ä»¶
â”‚   â”œâ”€â”€ lib/                           # å·¥å…·åº“
â”‚   â”‚   â”œâ”€â”€ api.ts                     # REST API å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ websocket.ts               # WebSocket å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ utils.ts                   # cn() å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ stores/                        # Zustand stores
â”‚   â”‚   â””â”€â”€ use-conversation-store.ts  # å¯¹è¯çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ next.config.mjs
â”‚   â”œâ”€â”€ tailwind.config.ts
â”‚   â”œâ”€â”€ postcss.config.js
â”‚   â”œâ”€â”€ .env.local
â”‚   â””â”€â”€ .env.example
â”‚
â”œâ”€â”€ backend/                           # FastAPI åç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.py                    # FastAPI åº”ç”¨å…¥å£
â”‚   â”‚   â”œâ”€â”€ config.py                  # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ api/                       # API è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ chat.py                # WebSocket èŠå¤©
â”‚   â”‚   â”‚   â”œâ”€â”€ conversations.py       # å¯¹è¯ CRUD
â”‚   â”‚   â”‚   â””â”€â”€ upload.py              # æ–‡ä»¶ä¸Šä¼ 
â”‚   â”‚   â”œâ”€â”€ core/                      # æ ¸å¿ƒæœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ llm_client.py          # LLM å®¢æˆ·ç«¯
â”‚   â”‚   â”‚   â””â”€â”€ streaming.py           # æµå¼å“åº”å·¥å…·
â”‚   â”‚   â”œâ”€â”€ agents/                    # Agent ç³»ç»Ÿ
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py                # Agent åŸºç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ supervisor.py          # ä¸»ç®¡ Agent
â”‚   â”‚   â”‚   â”œâ”€â”€ financial.py           # é‡‘èåˆ†æ Agent
â”‚   â”‚   â”‚   â””â”€â”€ document.py            # æ–‡æ¡£åˆ†æ Agent
â”‚   â”‚   â”œâ”€â”€ services/                  # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ attachment.py          # é™„ä»¶å¤„ç†
â”‚   â”‚   â”‚   â””â”€â”€ document.py            # æ–‡æ¡£è§£æ
â”‚   â”‚   â”œâ”€â”€ models/                    # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ conversation.py        # å¯¹è¯æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ db/                        # æ•°æ®åº“
â”‚   â”‚   â”‚   â””â”€â”€ mongo.py               # MongoDB è¿æ¥
â”‚   â”‚   â””â”€â”€ utils/                     # å·¥å…·å‡½æ•°
â”‚   â”‚       â””â”€â”€ logger.py              # æ—¥å¿—é…ç½®
â”‚   â”œâ”€â”€ temp/                          # ä¸´æ—¶æ–‡ä»¶ç›®å½•ï¼ˆ.gitignoreï¼‰
â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â””â”€â”€ .env.example
â”‚
â”œâ”€â”€ docs/                              # æ–‡æ¡£
â”‚   â”œâ”€â”€ main.md                        # v1.0 è®¾è®¡æ–‡æ¡£
â”‚   â”œâ”€â”€ v1.1.md                        # v1.1 æ›´æ–°æ–‡æ¡£
â”‚   â””â”€â”€ v1.2.md                        # æœ¬æ–‡æ¡£
â”œâ”€â”€ start.sh                           # å¿«é€Ÿå¯åŠ¨è„šæœ¬
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
```

## 8. ç¯å¢ƒé…ç½®

### å‰ç«¯ç¯å¢ƒå˜é‡ (.env.local)
```bash
# Backend API URL
NEXT_PUBLIC_API_URL=http://localhost:6969/api

# WebSocket URL
NEXT_PUBLIC_WS_URL=ws://localhost:6969/api/chat/ws
```

### åç«¯ç¯å¢ƒå˜é‡ (.env)
```bash
# Server
HOST=0.0.0.0
PORT=6969
DEBUG=true

# MongoDB
MONGO_URL=mongodb://localhost:27017
DATABASE_NAME=ai_chat_assistant

# LLM API Keys
OPENAI_API_KEY=sk-xxx
ANTHROPIC_API_KEY=sk-ant-xxx

# è‡ªå®šä¹‰ LLM (å¦‚ Qwen)
API_KEY=your-api-key
BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1
DEFAULT_MODEL=qwen-max
DEFAULT_LLM_PROVIDER=qwen

# File Upload
MAX_UPLOAD_SIZE=10485760  # 10MB
TEMP_DIR=./temp
TEMP_FILE_CLEANUP_INTERVAL=24
```

## 9. å¿«é€Ÿå¼€å§‹

### å¯åŠ¨æœåŠ¡
```bash
# ä¸€é”®å¯åŠ¨å‰åç«¯
./start.sh

# æˆ–åˆ†åˆ«å¯åŠ¨
# åç«¯
cd backend
uv pip install -e .
uv run uvicorn src.main:app --host 0.0.0.0 --port 6969 --reload

# å‰ç«¯
cd frontend
npm install
npm run dev
```

### è®¿é—®åœ°å€
- å‰ç«¯ï¼šhttp://localhost:3000
- åç«¯ APIï¼šhttp://localhost:6969
- API æ–‡æ¡£ï¼šhttp://localhost:6969/docs
- WebSocketï¼šws://localhost:6969/api/chat/ws/{conv_id}

## 10. å¾…å®ç°åŠŸèƒ½

### é«˜ä¼˜å…ˆçº§
1. ğŸ” **èº«ä»½éªŒè¯ç³»ç»Ÿ**
   - JWT token è®¤è¯
   - WebSocket è¿æ¥éªŒè¯
   - ç”¨æˆ·ç®¡ç†æ¥å£

2. ğŸ›¡ï¸ **å®‰å…¨åŠ å›º**
   - CORS ç™½åå•é…ç½®
   - é€Ÿç‡é™åˆ¶
   - æ–‡ä»¶ä¸Šä¼ å®‰å…¨å¢å¼º
   - è¾“å…¥éªŒè¯å’Œæ¶ˆæ¯’

3. ğŸ“Š **æ€§èƒ½ä¼˜åŒ–**
   - æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
   - è¿æ¥æ± é…ç½®
   - å‰ç«¯è™šæ‹Ÿæ»šåŠ¨
   - ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½

### ä¸­ä¼˜å…ˆçº§
4. ğŸ§ª **æµ‹è¯•è¦†ç›–**
   - åç«¯å•å…ƒæµ‹è¯•
   - å‰ç«¯ç»„ä»¶æµ‹è¯•
   - E2E æµ‹è¯•

5. ğŸ“ **æ—¥å¿—å’Œç›‘æ§**
   - ç»“æ„åŒ–æ—¥å¿—
   - æ€§èƒ½ç›‘æ§
   - é”™è¯¯è¿½è¸ª

6. ğŸ¨ **UI/UX æ”¹è¿›**
   - åŠ è½½éª¨æ¶å±
   - é”™è¯¯è¾¹ç•Œ
   - æ— éšœç¢åŠŸèƒ½
   - å“åº”å¼ä¼˜åŒ–

### ä½ä¼˜å…ˆçº§
7. ğŸš€ **éƒ¨ç½²é…ç½®**
   - Docker é…ç½®
   - CI/CD æµç¨‹
   - ç”Ÿäº§ç¯å¢ƒé…ç½®

8. ğŸ”Œ **åŠŸèƒ½æ‰©å±•**
   - æ›´å¤š Agent ç¤ºä¾‹
   - å¯¼å‡ºå¯¹è¯è®°å½•
   - è¯­éŸ³è¾“å…¥
   - å¤šè¯­è¨€æ”¯æŒ

## 11. å·²çŸ¥é™åˆ¶

1. **æ— ç”¨æˆ·ç³»ç»Ÿ**ï¼šå½“å‰ç‰ˆæœ¬ä¸åŒºåˆ†ç”¨æˆ·ï¼Œæ‰€æœ‰å¯¹è¯å…±äº«
2. **æ— ä¼šè¯æŒä¹…åŒ–**ï¼šæµè§ˆå™¨åˆ·æ–°åå½“å‰å¯¹è¯çŠ¶æ€ä¸¢å¤±ï¼ˆéœ€é‡æ–°åŠ è½½ï¼‰
3. **å•æ–‡ä»¶ä¸Šä¼ **ï¼šä¸æ”¯æŒå¤šæ–‡ä»¶åŒæ—¶ä¸Šä¼ 
4. **æ— é‡è¯•æœºåˆ¶**ï¼šæ¶ˆæ¯å‘é€å¤±è´¥æ— è‡ªåŠ¨é‡è¯•
5. **æ— ç¦»çº¿æ”¯æŒ**ï¼šå¿…é¡»åœ¨çº¿æ‰èƒ½ä½¿ç”¨

## 12. å¼€å‘å»ºè®®

### ä»£ç è§„èŒƒ
- åç«¯ï¼šéµå¾ª PEP 8ï¼Œä½¿ç”¨ç±»å‹æ³¨è§£
- å‰ç«¯ï¼šéµå¾ª ESLint + Prettier é…ç½®
- æäº¤æ¶ˆæ¯ï¼šä½¿ç”¨ Conventional Commits æ ¼å¼

### Git å·¥ä½œæµ
```bash
# åŠŸèƒ½å¼€å‘
git checkout -b feature/your-feature
git commit -m "feat: add new feature"

# Bug ä¿®å¤
git checkout -b fix/bug-name
git commit -m "fix: resolve websocket connection issue"

# æ–‡æ¡£æ›´æ–°
git commit -m "docs: update API documentation"
```

### æµ‹è¯•å‘½ä»¤
```bash
# åç«¯æµ‹è¯•
cd backend
pytest

# å‰ç«¯æµ‹è¯•
cd frontend
npm test

# æ„å»º
npm run build

# ä»£ç æ£€æŸ¥
npm run lint
```

## 13. è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

### Pull Request æ£€æŸ¥æ¸…å•
- [ ] ä»£ç é€šè¿‡æ‰€æœ‰æµ‹è¯•
- [ ] æ–°å¢åŠŸèƒ½æœ‰æ–‡æ¡£è¯´æ˜
- [ ] éµå¾ªä»£ç è§„èŒƒ
- [ ] æ— å®‰å…¨æ¼æ´
- [ ] æ€§èƒ½æ— æ˜æ˜¾å›é€€

## 14. è®¸å¯è¯

MIT License

## 15. è”ç³»æ–¹å¼

- é¡¹ç›®åœ°å€ï¼š[GitHub Repository]
- é—®é¢˜åé¦ˆï¼š[Issues]
- è®¨è®ºåŒºï¼š[Discussions]

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.2
**æœ€åæ›´æ–°**: 2026-02-05
**ç»´æŠ¤è€…**: AI Chat Assistant Team
